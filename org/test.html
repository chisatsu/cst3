
<!DOCTYPE html>
<html>
    <!--▼ヘッダ▼-->  
	<head>
		<title>テスト</title>
		<meta http-equiv="content-type" charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=0.8" />
	</head>
    <!--▲ヘッダ▲-->  

    <!--★スタイルシート -->  
	<link rel="stylesheet" href="test.css">

    <!--▼処理▼-->  
	<script type="text/javascript">

        function start() {
        }
/*
const textarea = document.getElementsByName('example');
const placeholderDiv = document.getElementsByName('placeholderDiv');

textarea.on('keyup change', function () {
 // textareaの文字を数える
 let letterLength = textarea.val().length;
  if (letterLength !== 0) {
   placeholderDiv.addClass('none');
  } else {
   placeholderDiv.removeClass('none');
  }
});
*/

		function p1clc() {
			var foo = document.getElementById("foo").value;
			if (foo == 0) {
				document.getElementById("foo").value = document.getElementsByName('example')[0].value;
				document.getElementsByName('example')[0].value = '';
			}
		}
		function p1clr() {
			document.getElementsByName('example')[0].value = "";
//			var foo = document.getElementById("foo").value;
//			if (foo != 0) {
//				document.getElementsByName('example')[0].value = document.getElementById("foo").value;
//				document.getElementById("foo").value = 0;
//			}
		}
		function p1exe() {
			//document.getElementsByName('example')[0].value = 111;
			//alert('1回目');
			//document.getElementById("area1").innerText = "変更しました";
			//alert('2回目');

			var foo = document.getElementById("foo").value;
			document.getElementById('p1').style.display = "none";
			document.getElementById('p2').style.display = "";
			document.getElementById('p3').style.display = "none";
			mainExe();
		}
		function p1sample() {
			document.getElementsByName('example')[0].value = "佐藤,2774\n鈴木,2551\n高橋,1848\n田中,1999\n伊藤,2300\n渡辺,2109\n山本,2467\n中村,2110\n小林,1970\n加藤,2656\n吉田,2094\n山田,2418\n佐々木,2227\n山口,2174\n松本,2442\n井上,2053\n木村,2033\n林,2500\n斎藤,2362\n清水,2385\n";
		}
		function p2bak() {
			document.getElementById('p1').style.display = "";
			document.getElementById('p2').style.display = "none";
			document.getElementById('p2').style.display = "none";
		}
		function p2exe() {
			document.getElementById('p1').style.display = "none";
			document.getElementById('p2').style.display = "none";
			document.getElementById('p3').style.display = "";
			calcExe();
		}
		function p3bak() {
			document.getElementById('p1').style.display = "none";
			document.getElementById('p2').style.display = "";
			document.getElementById('p3').style.display = "none";
		}
		function p3copy() {
			// クリップボードにコピー
			navigator.clipboard.writeText("コピーしたテキスト");
		}

		// パワーの合計を求める関数
		const sum = (array) => {
		  let total = 0;
		  for (let item of array) {
		    total += item.power;
		  }
		  return total;
		};

		// パワーの平均を求める関数
		const average = (array) => {
		  return sum(array) / array.length;
		};

		// パワーの差の絶対値を求める関数
		const difference = (a, b) => {
		  return Math.abs(a - b);
		};

		// チームを分ける関数
		const divide = (array) => {
		  // チームの人数
		  const teamSize = 4;
		  // チームの数
		  const teamNum = array.length / teamSize;
		  // チームの配列
		  const teams = [];
		  // パワーの平均の配列
		  const averages = [];
		  // パワーの平均の差の最小値
		  let minDiff = Infinity;
		  // パワーの平均の差の最小値を持つチームのインデックス
		  let minIndex = -1;

		  // チームをランダムに分ける
		  for (let i = 0; i < teamNum; i++) {
		    // チームを作る
		    let team = [];
		    // チームに人を追加する
		    for (let j = 0; j < teamSize; j++) {
		      // データからランダムに要素を選ぶ
		      let index = Math.floor(Math.random() * array.length);
		      // 選んだ要素をチームに追加する
		      team.push(array[index]);
		      // データから選んだ要素を削除する
		      array.splice(index, 1);
		    }
		    // チームをチームの配列に追加する
		    teams.push(team);
		    // チームのパワーの平均を求める
		    let avg = average(team);
		    // パワーの平均をパワーの平均の配列に追加する
		    averages.push(avg);
		  }

		  // パワーの平均の差の最小値を持つチームを最初に表示する
		  let firstTeam = teams.splice(minIndex, 1)[0];
		  teams.unshift(firstTeam);

		  // チームの配列を返す
		  return teams;
		};


		function mainExe() {
			
			const iniStr = document.getElementsByName('example')[0].value;
			const newStr = iniStr.replaceAll('\t', ',');
			const array = newStr.split(/\r\n|\n|\r/);
			const result = array.filter( s => (0 <= s.indexOf(",")) ^ false); // ^ は XOR 排他論

			// パワーの最小値
			let minPow = Infinity;
			// パワーの最大値
			let manPow = -Infinity;
			// パワーの合計
			let total = 0;

			for (let i = 0; i < result.length; i++) {
				console.log(`${i + 1}:${result[i]}`);
				let pow = result[i].split(',');
				if (pow[1] < minPow) {
					minPow = pow[1];
				}
				if (pow[1] > manPow) {
					manPow = pow[1];
				}
				total += Number(pow[1]);
			}
//			console.log(`対象人数　：${result.length}人`);
//			console.log(`チーム数：${Math.round(result.length/4)}`);
//			console.log(`最大パワー：${manPow}`);
//			console.log(`平均パワー：${Math.round(total/result.length)}`);
//			console.log(`最小パワー：${minPow}`);

			document.getElementById("ninzu").innerHTML = `対象人数　：${result.length}人`;
			document.getElementById("teams").innerHTML = `チーム数：${Math.round(result.length/4)}`;
			document.getElementById("taisg").innerHTML = `対象外メンバー：なし`;
			document.getElementById("maxpw").innerHTML = `最大パワー：${manPow}`;
			document.getElementById("avgpw").innerHTML = `平均パワー：${Math.round(total/result.length)}`;
			document.getElementById("mixpw").innerHTML = `最小パワー：${minPow}`;
			
		}

		function calcExe() {
		
			const trycnt = document.getElementById("trycnt").value;
			const allow = document.getElementById("allow").value;
		
			document.getElementById("result1").innerHTML = `許容差：${allow}、試行数：${trycnt}、成立数：11`;
			document.getElementById("result2").innerHTML = `最大差：28、最小差：5、成立率：25%`;
			
			const iniStr = document.getElementsByName('example')[0].value;
			const newStr = iniStr.replaceAll('\t', ',');
			const array = newStr.split(/\r\n|\n|\r/);
			const result = array.filter( s => (0 <= s.indexOf(",")) ^ false); // ^ は XOR 排他論

			// パワーの最小値
			let minPow = Infinity;
			// パワーの最大値
			let manPow = -Infinity;
			// パワーの合計
			let total = 0;

			// カンマ区切り配列を連想配列に変換
			let data = {};
			for (let i = 0; i < result.length; i++) {
				let pow = result[i].split(',');
				data[pow[0]] = pow[1];
			}
			
			
			
			
			
			// 複製するHTML要素を取得
			const element = document.getElementById("oneset");

			// 要素を複製
			const newelement = element.cloneNode(true);

			// 子要素を指定しname属性の値を変更
			const newelement_name = newelement.children[0];
			const newelement_powd = newelement_name.children[0];
			newelement_powd.innerText = 'パターン02、最大2218、最小1199、差分500';
//			newelement_name.innerText = 'パターン02、最大2218、最小1199、差分500';

			const newelement_tabd = newelement.children[1];
			const newelement_tabl = newelement_tabd.children[0];

			// テーブル書き換え
			for (let i = 0; i < 10; i++) {
				for (let j = 0; j < 4; j++) {
					newelement_tabl.rows[i].cells[j].innerHTML = `i=${i},j=${j}`;
				}
			}

			//親要素を取得し 複製した要素を追加
			const parent = document.getElementById("loopout");
			parent.appendChild(newelement);


// table要素を取得
//var tableElem = document.getElementById('sample-table');
// tbody要素にtr要素（行）を最後に追加
//var trElem = tableElem.tBodies[0].insertRow(-1);\
// td要素を追加
//var cellElem = trElem.insertCell(0);
// td要素にテキストを追加
//cellElem.appendChild(document.createTextNode('セル'));

			
			//一番上までスクロール
			scrollTo(0, 0);
			scrollTo(0, 0);
			scrollTo(0, 0);
			scrollTo(0, 0);
			scrollTo(0, 0);
			scrollTo(0, 0);
			scrollTo(0, 0);
			scrollTo(0, 0);
			scrollTo(0, 0);
//			window.scroll({
//				top: 0,
//				behavior: "smooth",
//			});
		}

	</script>
    <!--▲処理▲-->  

	<body onload="start()">
		<div class="parent">
			<!--<div style="text-align:center;">-->

		    <!--▼入力画面▼-->  
			<div class="flex_test-box" id="p1">
				<div class="flex_test-item">
					<h3>4人1チームのパワー均等割り試行</h3>
				</div>
				<div class="flex_test-item">
					<h2 id="or">メンバーの名前とパワーを入力</h2>
				</div>
				<div class="flex_test-item">
					<input type="hidden" value="0" id="foo" />
					<textarea name="example" id="example" class="big" cols="40" rows="25" onclick="p1clc()" placeholder="例）&#13;佐藤,2774&#13;鈴木,2551&#13;高橋,1848&#13;田中,1999&#13;伊藤,2300&#13;渡辺,2109&#13;山本,2467&#13;中村,2110&#13;小林,1970&#13;加藤,2656&#13;吉田,2094&#13;山田,2418&#13;佐々木,2227&#13;山口,2174&#13;松本,2442&#13;井上,2053&#13;木村,2033&#13;林,2500&#13;斎藤,2362&#13;清水,2385&#13;&#13;このように縦に入力してください。&#13;Excelからも張り付けれます。"></textarea>
				</div>
				<br>
				<div class="flex_test-item">
					<!--<button name="button" class="btn btn--orange" onclick="p1exe()">実行</button>-->
					<a href="#" class="btn_03" onclick="p1clr()">クリア</a>
					<a href="#" class="btn_04" onclick="p1exe()">実行</a>
				</div>
				<div class="flex_test-item">
					<a href="#" onclick="p1sample()">サンプルデータ入力</a>
				</div>
				<div id="area1"></div>
			</div>
		    <!--▲入力画面▲-->  

		    <!--▼確認画面▼-->  
			<div class="flex_test-box" id="p2" style="display: none;">
		<!--<div class="flex_test-box" id="p2" style="display: none;">-->
				<div class="flex_test-item">
					<h2 id="ninzu">対象人数　：8人</h2>
				</div>
				<div class="flex_test-item">
					<h2 id="teams">チーム数：2</h2>
				</div>
				<div class="flex_test-item">
					<h2 id="taisg">対象外メンバー：なし</h2>
				</div>
				<div class="flex_test-item">
					<h2 id="maxpw">最大パワー：9999</h2>
				</div>
				<div class="flex_test-item">
					<h2 id="avgpw">平均パワー：</h2>
				</div>
				<div class="flex_test-item">
					<h2 id="mixpw">最小パワー：</h2>
				</div>

				<div class="textbox">
					<input type="text" id="trycnt" placeholder="&nbsp;" value="10000" />
					<label for="name">試行数</label>
				</div>
				<div class="textbox">
					<input type="text" id="allow" placeholder="&nbsp;" value="50" />
					<label for="name">許容差</label>
				</div>

				<div class="flex_test-item">
					<a href="#" class="btn_03" onclick="p2bak()">戻る</a>
					<a href="#" class="btn_04" onclick="p2exe()">実行</a>
				</div>
			</div>
		    <!--▲確認画面▲-->  

		    <!--▼結果画面▼-->  
			<div class="flex_test-box" id="p3" style="display: none;">
		<!--<div class="flex_test-box" id="p3" style="display: none;">-->
				<div class="loopout" id="loopout">
					<div class="flex_test-item">
						<h3>パワー均等割り試行結果</h3>
					</div>
					<div class="flex_test-item">
						<h3 id="result1">許容差：30、試行数：35/100、成立数：11</h3>
					</div>
					<div class="flex_test-item">
						<h3 id="result2">最大差：28、最小差：5、成立率：25%</h3>
					</div>
					<div class="oneset" id="oneset">
						<div class="box22" name="box22">
							<div class="teampow01" id="teampow01">
								<p name="head01">パターン01、最大2258、最小2253、差分5</p>
							</div>
							<a name="copy01" href="#" class="btn-square-so-pop">COPY</a>
						</div>
						<div class="flex_test-item">
							<table id="table01" align="center">
							    <tbody align="center">
							        <tr>
							            <td>チームA</td>
							            <td>平均：2255</td>
							            <td>チームB</td>
							            <td>平均：2257</td>
							        </tr>
							        <tr>
							            <td>加藤</td>
							            <td>2656</td>
							            <td>山本</td>
							            <td>2467</td>
							        </tr>
							        <tr>
							            <td>山本</td>
							            <td>2467</td>
							            <td>中村</td>
							            <td>2110</td>
							        </tr>
							        <tr>
							            <td>田中</td>
							            <td>1999</td>
							            <td>渡辺</td>
							            <td>2109</td>
							        </tr>
							        <tr>
							            <td>高橋</td>
							            <td>1848</td>
							            <td>小林</td>
							            <td>1970</td>
							        </tr>
							        <tr>
							            <td id="gg">チームC</td>
							            <td id="gg">平均：2268</td>
							            <td id="gg"></td>
							            <td id="gg"></td>
							        </tr>
							        <tr>
							            <td id="gg">ちーちゃん</td>
							            <td id="gg">2442</td>
							            <td id="gg"></td>
							            <td id="gg"></td>
							        </tr>
							        <tr>
							            <td id="gg">あぶ</td>
							            <td id="gg">2362</td>
							            <td id="gg"></td>
							            <td id="gg"></td>
							        </tr>
							        <tr>
							            <td id="gg">ミジンコ</td>
							            <td id="gg">2174</td>
							            <td id="gg"></td>
							            <td id="gg"></td>
							        </tr>
							        <tr>
							            <td id="gg">りったい</td>
							            <td id="gg">2094</td>
							            <td id="gg"></td>
							            <td id="gg"></td>
							        </tr>
							    </tbody>
							</table>
						</div>
					</div>
				</div>
				<div class="flex_test-item">
					<a href="#" class="btn_03" onclick="p3bak()">戻る</a>
				</div>
			</div>
		    <!--▲結果画面▲-->  
		</div>
<!--
		<div class="container">
		  <div class="box">あ</div>
		  <div class="box">い</div>
		  <div class="box">う</div>
		  <div class="box">え</div>
		  <div class="box">お</div>
		</div>
-->
	</body>
</html>
